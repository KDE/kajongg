# This script generates a tarball, a rpm package and a debian package.
# The packages do not define dependencies yet.

# License: GNU GPL V2

# Copyright 2009,2010 Wolfgang Rohdewald <wolfgang@rohdewald.de>

# Usage: Start it as superuser in the the directory 
# containing the svn kajongg source.

# The kajongg help text is expected in ../doc/kajongg - that is
# how the KDE svn repository is organized.

# we might want to look at http://www.infukor.com/rally7.html
# which seems to do a nice job generating a python game .deb package

if test ! -d ../doc/kajongg
then
	echo 'directory ../doc/kajongg is missing. You need to mirror
the directory structure of the kde svn repository.'
	exit 2
fi
rm -rf doc kajongg-?.?.? /var/tmp/kajongg-*
ln -s ../doc/kajongg doc
rm -rf MANIFEST dist build locale
#./compile.sh
./setup.py bdist_rpm
cd dist

# by default Debian packages compress all files in /usr/share/doc,
# we do not want that to happen with index.docbook

alien --generate *.noarch.rpm
cd kajongg-*
mv debian/rules debian/rules.org
cat debian/rules.org | sed 's/dh_compress/dh_compress -X.docbook/' > debian/rules
chmod 755 debian/rules
debian/rules binary
cd ../..
rm doc
rm -rf MANIFEST build
cd dist
cp -a *.deb *.rpm *.tar.gz $HOME/Texte/H/strato/oss
upd_web
